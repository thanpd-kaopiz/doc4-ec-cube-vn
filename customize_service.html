<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.5 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="vi" class="no-js">
<head>
    <meta charset="utf-8">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MKP69WF');</script>
<!-- End Google Tag Manager -->

<!-- begin _includes/seo.html --><title>Tuỳ biến luồng mua hàng - &lt; for EC-CUBE 4 Developers /&gt;</title>
<meta name="description" content="Tuỳ biến giỏ hàng #2613">



<meta property="og:type" content="article">
<meta property="og:locale" content="vi_VN">
<meta property="og:site_name" content="EC-CUBE 4 開発者向けドキュメントサイト">
<meta property="og:title" content="Tuỳ biến luồng mua hàng">
<meta property="og:url" content="http://0.0.0.0:4000/customize_service">


  <meta property="og:description" content="Tuỳ biến giỏ hàng #2613">



  <meta property="og:image" content="http://0.0.0.0:4000/assets/images/site-logo.png">





  <meta property="article:published_time" content="2025-06-20T09:12:05+00:00">





  

  


<link rel="canonical" href="http://0.0.0.0:4000/customize_service">





  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "http://0.0.0.0:4000",
      "logo": "http://0.0.0.0:4000/assets/images/site-logo.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "EC-CUBE",
      "url": "http://0.0.0.0:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->

<!-- Google Search Console -->
<meta name="google-site-verification" content="RaTQVaBvAuWi45pAV3ydq19nxTrbyV1vooYDZqFA5kQ" />


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="< for EC-CUBE 4 Developers /> Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="/assets/font-awesome-4.7.0/css/font-awesome.min.css">
<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="shortcut icon" href="/assets/images/favicon.ico">

<!-- end custom head snippets -->

</head>

<body class="layout--single">
<nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

<!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->



<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          < for EC-CUBE 4 Developers />
          <span class="site-subtitle">EC-CUBE 4 開発者向けドキュメントサイト</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="https://www.ec-cube.net/" target="_blank" >Về EC-CUBE</a>
            </li><li class="masthead__menu-item">
              <a href="https://xoops.ec-cube.net/" target="_blank" >Cộng đồng phát triển</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


<div class="initial-content">
    



<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">ec-cube.co</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/co" class="">ec-cube.co là gì</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/co/co_security" class="">Về các biện pháp bảo mật</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/co/co_update_guidelines" class="">Hướng dẫn cập nhật</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/co/co_console" class="">Console</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/co/co_naming_rules" class="">Quy tắc đặt tên</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/co/co_git" class="">Đặc tả chức năng quản lý Git</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/co/co_customize_dir_usage" class="">Cách sử dụng thư mục tùy chỉnh</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/co/co_staging" class="">Xây dựng môi trường thử nghiệm</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/co/co_log" class="">Cách lấy log</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/co/co_faq" class="">FAQ</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Giới thiệu</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/quickstart/latest_version" class="">Phiên bản mới nhất</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/quickstart/requirement" class="">Yêu cầu hệ thống</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/quickstart/cautions_of_prod" class="">Lưu ý khi sử dụng trong môi trường sản xuất</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Thông tin cho người mới bắt đầu</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/learning/learning_step" class="">Các bước học tập</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Cài đặt</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/quickstart/install" class="">Các phương pháp cài đặt khác nhau</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/quickstart/cli" class="">Giao diện dòng lệnh</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Nâng cấp phiên bản</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/update43" class="">Nâng cấp phiên bản chính từ 4.2 lên 4.3</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/update-42-43" class="">Di chuyển từ 4.2 lên 4.3</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/update-41-42" class="">Di chuyển từ 4.1 lên 4.2</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/update41" class="">Nâng cấp phiên bản chính từ 4.0 lên 4.1</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/update-40-41" class="">Di chuyển từ 4.0 lên 4.1</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/update42x" class="">Nâng cấp phiên bản chính 4.2</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/update41x" class="">Nâng cấp phiên bản chính 4.1</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/update" class="">Nâng cấp phiên bản chính 4.0</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/update/4_0_3" class="">Lưu ý trong phiên bản 4.0.3</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/hotfix_samesite_cookie" class="">Hỗ trợ Cookie SameSite</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Đặc tả chức năng</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="https://www.ec-cube.net/product/functions.php" target="_blank" class="">Danh sách chức năng</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/spec_order" class="">Liên quan đến đơn hàng</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/spec_tax" class="">Cài đặt thuế suất</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/spec_payment" class="">Cài đặt phương thức thanh toán</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Tùy chỉnh hệ thống</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/spec_directory-structure" class="">Cấu trúc thư mục</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/customize_controller" class="">Tùy chỉnh Controller</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/customize_entity" class="">Tùy chỉnh Entity</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/customize_repository" class="">Tùy chỉnh Repository</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/customize_formtype" class="">Tùy chỉnh FormType</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/customize_service" class="active">Tùy chỉnh quy trình mua hàng</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/customize_order_state_machine" class="">Tùy chỉnh trạng thái đơn hàng</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/customize_template" class="">Tùy chỉnh mẫu giao diện</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/customize_throttling" class="">Tùy chỉnh chức năng throttling</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/customize_twig_sandbox" class="">Kiểm soát danh sách cho phép bằng Twig Sandbox</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/customize_symfony" class="">Mở rộng bằng chức năng của Symfony</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/customize_symfony#command" class="">Phát triển Command</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Tùy chỉnh thiết kế</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/design_template" class="">Cơ bản về mẫu thiết kế</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/design_block" class="">Sử dụng block</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/design_layout" class="">Sử dụng quản lý bố cục</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/design_img" class="">Về quản lý hình ảnh</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/design_css" class="">Sử dụng CSS</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/design_sass" class="">Sử dụng Sass(scss)</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/design_form" class="">Thay đổi bố cục form</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/design_messages" class="">Tùy chỉnh thông điệp</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="https://eccube4-styleguide.herokuapp.com" target="_blank" class="">Tài liệu tham khảo thiết kế giao diện người dùng (hướng dẫn phong cách)</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="https://doc4.ec-cube.net/pdf/ec-cube4_design-guide180930.pdf" target="_blank" class="">Tài liệu tham khảo thiết kế giao diện quản trị (hướng dẫn thiết kế)</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="http://downloads.ec-cube.net/manual/documents/eccube4_xd_front_template.zip?argument=2qpV46CP&dmai=a5bf51b05bacc5" target="_blank" class="">Mẫu giao diện người dùng cho Adobe XD</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="http://downloads.ec-cube.net/manual/documents/eccube4_xd_admin_template.zip?argument=2qpV46CP&dmai=a5bf51b05bacc5" target="_blank" class="">Mẫu giao diện quản trị cho Adobe XD</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Phát triển plugin</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/plugin_spec" class="">Đặc tả plugin</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/plugin_install" class="">Cài đặt plugin</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/plugin_error" class="">Cách xử lý sự cố plugin</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/plugin_sample" class="">Mẫu plugin</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/plugin_development" class="">Phát triển plugin</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/plugin_mock_package_api" class="">Kiểm tra cài đặt qua Owner's Store</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/plugin_naming_conventions" class="">Quy tắc đặt tên khuyến nghị cho plugin</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/plugin_admin_nav" class="">Mở rộng điều hướng quản trị</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/plugin_eccube40" class="">Lưu ý khi sử dụng EC-CUBE4.0 (Composer v1)</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Thay đổi cài đặt</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/i18n_multilingualization" class="">Đa ngôn ngữ</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/i18n_currency" class="">Tiền tệ</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/i18n_timezone" class="">Múi giờ</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/environmental_setting" class="">Cài đặt môi trường</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/debug_mode" class="">Chế độ gỡ lỗi</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/session_handler_settings" class="">Phương pháp lưu trữ phiên</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Công cụ phát triển</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/development-tools/mail-catcher" class="">MailCatcher</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Thực hiện kiểm tra bảo mật</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/penetration-testing" class="">Giới thiệu</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/penetration-testing/quick_start" class="">Bắt đầu nhanh</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/penetration-testing/introduction" class="">Giới thiệu</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/penetration-testing/about_owaspzap" class="">Về OWASP ZAP</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/penetration-testing/planning" class="">Lập kế hoạch kiểm tra</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/penetration-testing/testing" class="">Thực hiện kiểm tra</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/penetration-testing/review" class="">Đánh giá kiểm tra</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/penetration-testing/improvement" class="">Cải thiện bảo mật</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Hướng dẫn bảo mật</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/security-guideline/coding" class="">Về mã hóa</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/security-guideline/plugin" class="">Tăng cường bảo mật trong phát triển plugin</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Tham khảo ngược</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/reverse-lookup/tips" class="">Mẹo</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/reverse-lookup/sample-code" class="">Bộ sưu tập mẫu tùy chỉnh</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Tham gia phát triển</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="https://www.ec-cube.net/committer/" target="_blank" class="">Làm thế nào để tham gia phát triển EC-CUBE? (Trang web chính thức)</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/contribution-guide/overview" class="">Tổng quan về phát triển</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/contribution-guide/pull-request" class="">Cách tạo pull request</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Khi không tìm thấy tài liệu</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/documents/request" class="">Yêu cầu tài liệu</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/documents/writing-and-formatting" class="">Thêm và viết tài liệu</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/documents/contribute" class="">Đóng góp tài liệu</a></li>
              
          
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Tuỳ biến luồng mua hàng">
    <meta itemprop="description" content="Tuỳ biến giỏ hàng #2613">
    <meta itemprop="datePublished" content="June 20, 2025">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Tuỳ biến luồng mua hàng
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
<!--
            <a href="#disqus_thread" style="font-size:21px;margin-bottom:3px;">
              <img src="//c.disquscdn.com/next/current/publisher-admin/assets/img/emoji/love-512x512.png" style="height: 24px;width: 24px;">
              ページを評価/質問する
              <img src="//c.disquscdn.com/next/current/publisher-admin/assets/img/emoji/sad-512x512.png" style="height: 24px;width: 24px;">
            </a>
-->
            <a href="https://github.com/EC-CUBE/doc4.ec-cube.net/edit/gh-pages/_pages/customize/customize_service.md"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> Chỉnh sửa trang</a>
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> Mục lục</h4></header>
              <ul class="toc__menu">
  <li><a href="#tuỳ-biến-giỏ-hàng-2613">Tuỳ biến giỏ hàng #2613</a>
    <ul>
      <li><a href="#tách-riêng-các-dòng-sản-phẩm-giống-nhau-nhưng-khác-tuỳ-chọn">Tách riêng các dòng sản phẩm giống nhau nhưng khác tuỳ chọn</a></li>
      <li><a href="#cho-phép-thêm-sản-phẩm-có-phương-thức-thanh-toán-khác-nhau-vào-cùng-giỏ">Cho phép thêm sản phẩm có phương thức thanh toán khác nhau vào cùng giỏ</a></li>
      <li><a href="#tuỳ-biến-luồng-mua-hàng-2424">Tuỳ biến luồng mua hàng #2424</a>
        <ul>
          <li><a href="#hoạt-động-tổng-thể">Hoạt động tổng thể</a></li>
          <li><a href="#luồng-xử-lý-tổng-hợp">Luồng xử lý tổng hợp</a></li>
          <li><a href="#sơ-đồ-class">Sơ đồ class</a>
            <ul>
              <li><a href="#itemiholderinterface">ItemIHolderInterface</a></li>
              <li><a href="#iteminterface">ItemInterface</a></li>
              <li><a href="#purchaseflow">PurchaseFlow</a></li>
              <li><a href="#itemvalidator">ItemValidator</a></li>
              <li><a href="#itemholdervalidator">ItemHolderValidator</a></li>
              <li><a href="#itempreprocessor">ItemPreprocessor</a></li>
              <li><a href="#itemholderpreprocessor">ItemHolderPreprocessor</a></li>
              <li><a href="#discountprocessor">DiscountProcessor</a></li>
              <li><a href="#itemholderpostvalidator">ItemHolderPostValidator</a></li>
              <li><a href="#purchaseprocessor">PurchaseProcessor</a></li>
              <li><a href="#purchasecontext">PurchaseContext</a></li>
              <li><a href="#purchaseflowresult">PurchaseFlowResult</a></li>
              <li><a href="#processor">Processor</a></li>
            </ul>
          </li>
          <li><a href="#ví-dụ-triển-khai-processor">Ví dụ triển khai Processor</a></li>
          <li><a href="#kích-hoạt-processor">Kích hoạt Processor</a>
            <ul>
              <li><a href="#định-nghĩa-trong-purchaseflowyaml">Định nghĩa trong purchaseflow.yaml</a></li>
              <li><a href="#chỉ-định-flow-bằng-annotation">Chỉ định flow bằng annotation</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
            </nav>
          </aside>
        
        <h2 id="tuỳ-biến-giỏ-hàng-2613">Tuỳ biến giỏ hàng <a href="https://github.com/EC-CUBE/ec-cube/issues/2613" target="_blank">#2613</a></h2>

<p>Bằng cách triển khai class <code class="language-plaintext highlighter-rouge">CartItemComparator</code> hoặc <code class="language-plaintext highlighter-rouge">CartItemAllocator</code>, bạn có thể tuỳ biến hành vi khi thêm sản phẩm vào giỏ hàng.</p>

<p><img src="http://www.plantuml.com/plantuml/png/hLNBRjD05DtFLyoobUY6PHP8A18IEoI-m3XJ6idDLAuBB3js7owrQ6cRD4MYfEJPHab3sqK90Jvc6CUVmSpu6JiHgOGLHHwFxxddtdFcUgLOG70PO-CLVWS0o2kwaSSbGyUQXdIuz0IA9o-H_gQeeXnK2WMnVcwWrGMtCg3ab98jj_fXV3TO140LGQfHnALrICqkjKRKil_SRtgjDYXX0q6z-7h5W7WvimlvzNXy-uEI3ZjqAAbIqwPaXv8ktIJUpIMhtumxVMOtnxqzyL3irYbfoS08Z9f7pEP17wcvHqs7clin33dZIu1A1IYO-8K6POagKuHo2L1ombbHqlVBzFT5feCA-tKAKe5mATsoP5YgHPmJ-SwhI843LKSAxzRC_GpvcIzg6Az1z_GhwrMZFN5J7W3PkXHGg6qUhwufkc9WFGTLUO_ISZzAmoxwYB7ESYckJFwEUttYZIm9r_Br3hUuK5T2Dy9_brAwVMOtt4hF5v1kcX4ijNQfLQRc9RMwKgSs9TUilCEEYTSwS6kZKBbk01wxOm8dMpIdolfVlFgs26bmmzcIqh54QtD7Hh4--Scat1pcb8n1kCDsX-xdPe93x4cnKZG3Jcq9gzsnGnjCq9x30w41EHTgdGkhclSB4ueXRHt1SNdWf_blMIi3qH3vpBjmlDy_sVjQAd6f083yapQDJfBVpZbi-bJJiEgxLF5lKPGXgMpqNlPqHaczNfMF5zOxdEdYe361fxA1lCFkjo7hVyfQrUsSkSDAR2jfrUWq9kTRPhY9Y_VKtJg8D8ap4jvNpgSS3BkfXlhNe0ldxRHo7Av2OsAy-aClvTIvWWb_qvp3KMb-qVH8G7Mdsadu-864hlWyUp0XwUnv2CtmT-3iCDVav_R5XgwkAElecORVyk6hQEg69dozcFBbb2zKrxiTiUsc68fMJvxq8-6t2oV--Fq5" alt="Sơ đồ chuỗi xử lý" /></p>

<h3 id="tách-riêng-các-dòng-sản-phẩm-giống-nhau-nhưng-khác-tuỳ-chọn">Tách riêng các dòng sản phẩm giống nhau nhưng khác tuỳ chọn</h3>

<p>Mặc định, các dòng sản phẩm trong giỏ sẽ được tách theo từng phân loại sản phẩm.
Ví dụ, khi tuỳ biến thêm tuỳ chọn sản phẩm như gói quà, bạn có thể triển khai <code class="language-plaintext highlighter-rouge">CartItemComparator</code> để tách dòng sản phẩm theo tuỳ chọn này.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kn">namespace</span> <span class="nn">Eccube\Service\Cart</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Eccube\Entity\CartItem</span><span class="p">;</span>

<span class="cd">/**
 * So sánh dòng sản phẩm theo phân loại và tuỳ chọn
 */</span>
<span class="kd">class</span> <span class="nc">ProductClassAndOptionComparator</span> <span class="kd">implements</span> <span class="nc">CartItemComparator</span>
<span class="p">{</span>
    <span class="cd">/**
     * @param CartItem $Item1 Dòng 1
     * @param CartItem $Item2 Dòng 2
     * @return boolean true nếu là cùng dòng
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">compare</span><span class="p">(</span><span class="kt">CartItem</span> <span class="nv">$Item1</span><span class="p">,</span> <span class="kt">CartItem</span> <span class="nv">$Item2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$ProductClass1</span> <span class="o">=</span> <span class="nv">$Item1</span><span class="o">-&gt;</span><span class="nf">getProductClass</span><span class="p">();</span>
        <span class="nv">$ProductClass2</span> <span class="o">=</span> <span class="nv">$Item2</span><span class="o">-&gt;</span><span class="nf">getProductClass</span><span class="p">();</span>
        <span class="nv">$product_class_id1</span> <span class="o">=</span> <span class="nv">$ProductClass1</span> <span class="o">?</span> <span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="nv">$ProductClass1</span><span class="o">-&gt;</span><span class="nf">getId</span><span class="p">()</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
        <span class="nv">$product_class_id2</span> <span class="o">=</span> <span class="nv">$ProductClass2</span> <span class="o">?</span> <span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="nv">$ProductClass2</span><span class="o">-&gt;</span><span class="nf">getId</span><span class="p">()</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$product_class_id1</span> <span class="o">===</span> <span class="nv">$product_class_id2</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Cần tuỳ biến thêm ProductOption</span>
            <span class="k">return</span> <span class="nv">$Item1</span><span class="o">-&gt;</span><span class="nf">getProductOption</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getId</span><span class="p">()</span> <span class="o">===</span> <span class="nv">$Item2</span><span class="o">-&gt;</span><span class="nf">getProductOption</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getId</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>Để kích hoạt CartItemComparator, tạo file <code class="language-plaintext highlighter-rouge">app/config/eccube/packages/cart.yaml</code> và thêm định nghĩa:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
    <span class="na">Eccube\Service\Cart\CartItemComparator</span><span class="pi">:</span>
      <span class="na">class</span><span class="pi">:</span> <span class="s">Eccube\Service\Cart\ProductClassAndOptionComparator</span>

</code></pre></div></div>

<h3 id="cho-phép-thêm-sản-phẩm-có-phương-thức-thanh-toán-khác-nhau-vào-cùng-giỏ">Cho phép thêm sản phẩm có phương thức thanh toán khác nhau vào cùng giỏ</h3>

<p>Ví dụ, có các phương thức giao hàng/phương thức thanh toán và sản phẩm như sau:</p>

<ul>
  <li>Phương thức giao hàng
    <ul>
      <li>A: Loại bán A/Thẻ tín dụng</li>
      <li>B: Loại bán A/Thanh toán khi nhận</li>
    </ul>
  </li>
  <li>Sản phẩm
    <ul>
      <li>A: Loại bán A</li>
      <li>B: Loại bán B</li>
    </ul>
  </li>
</ul>

<p>Ở EC-CUBE 3.0, nếu thêm sản phẩm A vào giỏ, sau đó thêm sản phẩm B sẽ báo lỗi “Không thể mua cùng lúc sản phẩm này”.</p>

<p>Bằng cách triển khai <code class="language-plaintext highlighter-rouge">CartItemAllocator</code>, bạn có thể tách giỏ theo tiêu chí tuỳ ý (ví dụ: sản phẩm đặt trước, v.v.).</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kn">namespace</span> <span class="nn">Eccube\Service\Cart</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Eccube\Entity\CartItem</span><span class="p">;</span>

<span class="cd">/**
 * Tách giỏ theo loại bán và sản phẩm đặt trước
 */</span>
<span class="kd">class</span> <span class="nc">SaleTypeAndReserveCartAllocator</span> <span class="kd">implements</span> <span class="nc">CartItemAllocator</span>
<span class="p">{</span>
    <span class="cd">/**
     * Xác định mã giỏ cho sản phẩm
     *
     * @param CartItem $Item
     * @return string
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">allocate</span><span class="p">(</span><span class="kt">CartItem</span> <span class="nv">$Item</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$ProductClass</span> <span class="o">=</span> <span class="nv">$Item</span><span class="o">-&gt;</span><span class="nf">getProductClass</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$ProductClass</span> <span class="o">&amp;&amp;</span> <span class="nv">$ProductClass</span><span class="o">-&gt;</span><span class="nf">getSaleType</span><span class="p">())</span> <span class="p">{</span>
            <span class="nv">$salesTypeId</span> <span class="o">=</span> <span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="nv">$ProductClass</span><span class="o">-&gt;</span><span class="nf">getSaleType</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getId</span><span class="p">();</span>
            <span class="c1">// isReserveItem cần tuỳ biến thêm</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$ProductClass</span><span class="o">-&gt;</span><span class="nf">isReserveItem</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nv">$salesTypeId</span><span class="mf">.</span><span class="s1">':R'</span> <span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nv">$salesTypeId</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="err">\</span><span class="nf">InvalidArgumentException</span><span class="p">(</span><span class="s1">'ProductClass/SaleType not found'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>Để kích hoạt CartItemAllocator, tạo file <code class="language-plaintext highlighter-rouge">app/config/eccube/packages/cart.yaml</code> và thêm định nghĩa:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
    <span class="na">Eccube\Service\Cart\CartItemAllocator</span><span class="pi">:</span>
      <span class="na">class</span><span class="pi">:</span> <span class="s">Eccube\Service\Cart\SaleTypeAndReserveCartAllocator</span>

</code></pre></div></div>

<h3 id="tuỳ-biến-luồng-mua-hàng-2424">Tuỳ biến luồng mua hàng <a href="https://github.com/EC-CUBE/ec-cube/pull/2424" target="_blank">#2424</a></h3>

<p>Các xử lý tổng hợp, kiểm tra tồn kho… là các logic chung liên quan đến đơn hàng.
Trước đây, các xử lý này được cài đặt riêng lẻ ở nhiều nơi, gây khó khăn khi tuỳ biến hoặc tái sử dụng.</p>

<p>Từ EC-CUBE 4, các xử lý này được tách thành PurchaseFlow (điều khiển luồng) và Processor (xử lý từng bước), giúp tuỳ biến dễ dàng hơn.</p>

<h4 id="hoạt-động-tổng-thể">Hoạt động tổng thể</h4>

<p><img src="https://user-images.githubusercontent.com/8196725/28450154-7bd307a0-6e20-11e7-8827-9ee85c81136d.png" alt="purchaseflow-activity" /></p>

<h4 id="luồng-xử-lý-tổng-hợp">Luồng xử lý tổng hợp</h4>

<p>Ví dụ với giỏ hàng, các bước xử lý như sau:</p>

<ul>
  <li>Tải giỏ hàng từ session</li>
  <li>Kiểm tra trạng thái hiện tại của từng dòng sản phẩm
    <ul>
      <li>Kiểm tra giới hạn bán</li>
      <li>Kiểm tra tồn kho</li>
      <li>Kiểm tra trạng thái hiển thị</li>
      <li>…</li>
    </ul>
  </li>
  <li>Xử lý làm tròn số lượng theo kết quả kiểm tra
    <ul>
      <li>Giới hạn bán: giảm số lượng về đúng giới hạn</li>
      <li>Hết hàng: xoá dòng sản phẩm</li>
      <li>Không hiển thị: xoá dòng sản phẩm</li>
      <li>…</li>
    </ul>
  </li>
  <li>Tổng hợp: tính tổng tiền, phí vận chuyển, phí xử lý…</li>
  <li>Kiểm tra trạng thái tổng thể của giỏ
    <ul>
      <li>Kiểm tra loại sản phẩm</li>
      <li>Kiểm tra phương thức thanh toán</li>
      <li>Kiểm tra vượt giới hạn số tiền mua</li>
    </ul>
  </li>
  <li>Trả về lỗi nếu có</li>
  <li>Tổng hợp lại
    <ul>
      <li>Tính tổng tiền, phí vận chuyển, phí xử lý…</li>
    </ul>
  </li>
</ul>

<p><img src="https://user-images.githubusercontent.com/8196725/28610103-25570d30-7222-11e7-828c-a0a04e268df3.png" alt="default" /></p>

<h4 id="sơ-đồ-class">Sơ đồ class</h4>

<p><img src="https://user-images.githubusercontent.com/8196725/28611146-c9c6f83c-7225-11e7-9591-dc2e0e154cf5.png" alt="default" /></p>

<p>Vai trò các class chính:</p>

<h5 id="itemiholderinterface">ItemIHolderInterface</h5>

<p>Interface đại diện cho danh sách dòng sản phẩm (Cart, Order).</p>

<h5 id="iteminterface">ItemInterface</h5>

<p>Interface đại diện cho từng dòng sản phẩm (CartItem, OrderItem).</p>

<h5 id="purchaseflow">PurchaseFlow</h5>

<p>Class điều khiển toàn bộ luồng xử lý tổng hợp.
Có 2 hàm chính: <a href="https://github.com/EC-CUBE/ec-cube/pull/2424/files#diff-1d9b0d44b6269dc98b5c09f331ff0c41R48">calculate()</a> và <a href="https://github.com/EC-CUBE/ec-cube/pull/2424/files#diff-1d9b0d44b6269dc98b5c09f331ff0c41R80">purchase()</a>.
Khi gọi, sẽ truyền Item và ItemHolder vào các Processor để xử lý tuần tự, trả về kết quả.</p>

<h5 id="itemvalidator">ItemValidator</h5>

<p>Processor kiểm tra tính hợp lệ của từng dòng sản phẩm.</p>

<h5 id="itemholdervalidator">ItemHolderValidator</h5>

<p>Processor kiểm tra tính hợp lệ của toàn bộ giỏ/đơn hàng.</p>

<h5 id="itempreprocessor">ItemPreprocessor</h5>

<p>Processor tiền xử lý cho từng dòng sản phẩm.</p>

<h5 id="itemholderpreprocessor">ItemHolderPreprocessor</h5>

<p>Processor tiền xử lý cho toàn bộ giỏ/đơn hàng (tính thuế, phí vận chuyển…).</p>

<h5 id="discountprocessor">DiscountProcessor</h5>

<p>Processor xử lý giảm giá (điểm thưởng, coupon…).</p>

<h5 id="itemholderpostvalidator">ItemHolderPostValidator</h5>

<p>Processor kiểm tra hợp lệ cuối cùng cho giỏ/đơn hàng (ví dụ tổng tiền âm…).</p>

<h5 id="purchaseprocessor">PurchaseProcessor</h5>

<p>Processor xử lý hoàn tất đơn hàng (cập nhật tồn kho, điểm thưởng…).</p>

<h5 id="purchasecontext">PurchaseContext</h5>

<p>Class lưu trạng thái khi thực thi.</p>

<h5 id="purchaseflowresult">PurchaseFlowResult</h5>

<p>Class lưu kết quả thực thi PurchaseFlow.</p>

<h5 id="processor">Processor</h5>

<p>Tuỳ mục đích, kế thừa hoặc implement các interface/class sau:</p>

<table>
  <thead>
    <tr>
      <th>Class/Interface</th>
      <th>Mô tả</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ItemValidator</td>
      <td>Kiểm tra hợp lệ từng dòng (giá, trạng thái hiển thị…)</td>
    </tr>
    <tr>
      <td>ItemHolderValidator</td>
      <td>Kiểm tra hợp lệ toàn bộ giỏ/đơn hàng (tồn kho, giới hạn bán…)</td>
    </tr>
    <tr>
      <td>ItemPreprocessor</td>
      <td>Tiền xử lý từng dòng sản phẩm</td>
    </tr>
    <tr>
      <td>ItemHolderPreprocessor</td>
      <td>Tiền xử lý toàn bộ giỏ/đơn hàng (thêm phí vận chuyển…)</td>
    </tr>
    <tr>
      <td>DiscountProcessor</td>
      <td>Xử lý giảm giá (điểm thưởng, coupon…)</td>
    </tr>
    <tr>
      <td>ItemHolderPostValidator</td>
      <td>Kiểm tra hợp lệ cuối cùng cho giỏ/đơn hàng</td>
    </tr>
    <tr>
      <td>PurchaseProcessor</td>
      <td>Xử lý hoàn tất đơn hàng (cập nhật tồn kho, điểm thưởng…)</td>
    </tr>
  </tbody>
</table>

<h4 id="ví-dụ-triển-khai-processor">Ví dụ triển khai Processor</h4>

<p><code class="language-plaintext highlighter-rouge">EmptyProcessor::process()</code> sẽ ghi log khi được gọi.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">Plugin\PurchaseProcessors\Processor</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Eccube\Entity\ItemInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Eccube\Service\PurchaseFlow\ItemPreProcessor</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Eccube\Service\PurchaseFlow\PurchaseContext</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Eccube\Service\PurchaseFlow\ProcessResult</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">EmptyProcessor</span> <span class="kd">implements</span> <span class="nc">ItemPreProcessor</span>
<span class="p">{</span>
    <span class="cd">/**
     * @param ItemInterface $item
     * @param PurchaseContext $context
     * @return ProcessResult
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">process</span><span class="p">(</span><span class="kt">ItemInterface</span> <span class="nv">$item</span><span class="p">,</span> <span class="kt">PurchaseContext</span> <span class="nv">$context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nf">log_info</span><span class="p">(</span><span class="s1">'empty processor executed'</span><span class="p">,</span> <span class="p">[</span><span class="k">__METHOD__</span><span class="p">]);</span>
        <span class="k">return</span> <span class="nc">ProcessResult</span><span class="o">::</span><span class="nf">success</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>Nếu <code class="language-plaintext highlighter-rouge">ValidatableEmptyProcessor::validate()</code> ném ra <code class="language-plaintext highlighter-rouge">Eccube\Service\PurchaseFlow\InvalidItemException</code>, thì <code class="language-plaintext highlighter-rouge">ValidatableEmptyProcessor::handle()</code> sẽ được gọi và trả về <code class="language-plaintext highlighter-rouge">PurchaseFlowResult::warn()</code>.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">Plugin\PurchaseProcessors\Processor</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Eccube\Entity\ItemInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Eccube\Service\PurchaseFlow\InvalidItemException</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Eccube\Service\PurchaseFlow\PurchaseContext</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Eccube\Service\PurchaseFlow\ItemValidator</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">ValidatableEmptyProcessor</span> <span class="kd">extends</span> <span class="nc">ItemValidator</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="n">validate</span><span class="p">(</span><span class="kt">ItemInterface</span> <span class="nv">$item</span><span class="p">,</span> <span class="kt">PurchaseContext</span> <span class="nv">$context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$error</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nc">InvalidItemException</span><span class="p">(</span><span class="s1">'Lỗi ValidatableEmptyProcessor'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="n">handle</span><span class="p">(</span><span class="kt">ItemInterface</span> <span class="nv">$item</span><span class="p">,</span> <span class="kt">PurchaseContext</span> <span class="nv">$context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$item</span><span class="o">-&gt;</span><span class="nf">setQuantity</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<h4 id="kích-hoạt-processor">Kích hoạt Processor</h4>

<p>Để kích hoạt Processor tự tạo, thêm định nghĩa vào <code class="language-plaintext highlighter-rouge">app/config/eccube/packages/purchaseflow.yaml</code> hoặc dùng annotation chỉ định flow.</p>

<h5 id="định-nghĩa-trong-purchaseflowyaml">Định nghĩa trong <code class="language-plaintext highlighter-rouge">purchaseflow.yaml</code></h5>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="na">eccube.purchase.flow.cart.item_processors</span><span class="pi">:</span>
        <span class="na">class</span><span class="pi">:</span> <span class="s">Doctrine\Common\Collections\ArrayCollection</span>
        <span class="na">arguments</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="c1">#</span>
                <span class="pi">-</span> <span class="s1">'</span><span class="s">@Plugin\PurchaseProcessors\Processor\EmptyProcessor'</span> <span class="c1"># Thêm</span>
                <span class="pi">-</span> <span class="s1">'</span><span class="s">@Eccube\Service\PurchaseFlow\Processor\DisplayStatusValidator'</span>
                <span class="pi">-</span> <span class="s1">'</span><span class="s">@Eccube\Service\PurchaseFlow\Processor\SaleLimitValidator'</span>
                <span class="pi">-</span> <span class="s1">'</span><span class="s">@Eccube\Service\PurchaseFlow\Processor\DeliverySettingValidator'</span>
                <span class="pi">-</span> <span class="s1">'</span><span class="s">@Eccube\Service\PurchaseFlow\Processor\StockValidator'</span>
                <span class="pi">-</span> <span class="s1">'</span><span class="s">@Eccube\Service\PurchaseFlow\Processor\ProductStatusValidator'</span>
                <span class="pi">-</span> <span class="s1">'</span><span class="s">@Plugin\PurchaseProcessors\Processor\ValidatableEmptyProcessor'</span> <span class="c1"># Thêm</span>
</code></pre></div></div>

<h5 id="chỉ-định-flow-bằng-annotation">Chỉ định flow bằng annotation</h5>

<p>Dùng annotation <code class="language-plaintext highlighter-rouge">@CartFlow</code>, <code class="language-plaintext highlighter-rouge">@ShoppingFlow</code>, <code class="language-plaintext highlighter-rouge">@OrderFlow</code> để chỉ định flow cần thêm Processor.</p>

<table>
  <thead>
    <tr>
      <th>Annotation</th>
      <th>Mô tả</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>@CartFlow</td>
      <td>Thêm Processor vào PurchaseFlow của giỏ hàng</td>
    </tr>
    <tr>
      <td>@ShoppingFlow</td>
      <td>Thêm Processor vào PurchaseFlow của luồng mua hàng</td>
    </tr>
    <tr>
      <td>@OrderFlow</td>
      <td>Thêm Processor vào PurchaseFlow của quản trị</td>
    </tr>
  </tbody>
</table>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">Customize\Service\PurchaseFlow\Processor</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Eccube\Annotation\CartFlow</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Eccube\Annotation\OrderFlow</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Eccube\Annotation\ShoppingFlow</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Eccube\Entity\ItemInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Eccube\Service\PurchaseFlow\PurchaseContext</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Eccube\Service\PurchaseFlow\ItemValidator</span><span class="p">;</span>

<span class="cd">/**
 * Kích hoạt Processor cho tất cả các flow
 *
 * @CartFlow
 * @ShoppingFlow
 * @OrderFlow
 */</span>
<span class="kd">class</span> <span class="nc">SampleValidator</span> <span class="kd">extends</span> <span class="nc">ItemValidator</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="n">validate</span><span class="p">(</span><span class="kt">ItemInterface</span> <span class="nv">$item</span><span class="p">,</span> <span class="kt">PurchaseContext</span> <span class="nv">$context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Bỏ qua</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="n">handle</span><span class="p">(</span><span class="kt">ItemInterface</span> <span class="nv">$item</span><span class="p">,</span> <span class="kt">PurchaseContext</span> <span class="nv">$context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Bỏ qua</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

        
      </section>

      <footer class="page__meta">
        
        
  





        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Ngày cập nhật:</strong> <time datetime="2025-06-20T09:12:05+00:00">June 20, 2025</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Chia sẻ trang</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Tu%E1%BB%B3+bi%E1%BA%BFn+lu%E1%BB%93ng+mua+h%C3%A0ng%20http%3A%2F%2F0.0.0.0%3A4000%2Fcustomize_service" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Chia sẻ trang Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2F0.0.0.0%3A4000%2Fcustomize_service" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Chia sẻ trang Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>
</section>


<!--
      <div style="font-size: 15pt;margin-top:20px;margin-bottom:-30px;">
        <div>　</div>
        <div>　</div>
        <div style="font-weight:bold;">■質問、書いてほしい情報など、気軽にコメントしてみましょう！</div>
        <div>コメント例：</div>
        <div>　「手順通りやったけど、◯◯の部分でうまくいかない」</div>
        <div>　「◯◯の部分について、もう少し手順を詳細に記載してよ」</div>
        <div>　「最初から、こういう情報があればわかりやすかった」</div>
      </div>
-->

      <!--
  <nav class="pagination">
    
      <a href="/customize_repository" class="pagination--pager" title="Tuỳ biến Repository
">Trước</a>
    
    
      <a href="/customize_symfony" class="pagination--pager" title="Tuỳ biến với chức năng của Symfony
">Sau</a>
    
  </nav>
-->
    </div>

    
      <div class="page__comments">
  
  
</div>

    
  </article>

  
  
</div>

</div>


<div class="search-content">
    <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Nhập từ khóa tìm kiếm..." />
  </form>
  <div id="results" class="results"></div></div>

</div>


<div id="footer" class="page__footer">
    <footer>
        <!-- start custom footer snippets -->

<!-- Navメニュー -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
    $('.nav__sub-title').on('click',function(){
        $(this).toggleClass('active');
        $(this).next('ul').slideToggle();
    });
    $(function(){
        $("a.active").parents('ul').css("display", "block");
    });
</script>

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Theo dõi</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 EC-CUBE. Phát triển bởi <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

    </footer>
</div>


  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>









</body>
</html>
