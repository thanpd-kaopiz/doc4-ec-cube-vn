<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.5 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="vi" class="no-js">
<head>
    <meta charset="utf-8">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MKP69WF');</script>
<!-- End Google Tag Manager -->

<!-- begin _includes/seo.html --><title>Di chuyển từ 4.2 lên 4.3 - &lt; for EC-CUBE 4 Developers /&gt;</title>
<meta name="description" content="Giải thích về di chuyển từ EC-CUBE 4.2 lên 4.3.">



<meta property="og:type" content="article">
<meta property="og:locale" content="vi_VN">
<meta property="og:site_name" content="EC-CUBE 4 開発者向けドキュメントサイト">
<meta property="og:title" content="Di chuyển từ 4.2 lên 4.3">
<meta property="og:url" content="https://thanpd-kaopiz.github.io/doc4-ec-cube-vn/update-42-43">


  <meta property="og:description" content="Giải thích về di chuyển từ EC-CUBE 4.2 lên 4.3.">



  <meta property="og:image" content="https://thanpd-kaopiz.github.io/doc4-ec-cube-vn/assets/images/site-logo.png">





  <meta property="article:published_time" content="2025-06-20T10:15:25+00:00">





  

  


<link rel="canonical" href="https://thanpd-kaopiz.github.io/doc4-ec-cube-vn/update-42-43">





  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "https://thanpd-kaopiz.github.io/doc4-ec-cube-vn",
      "logo": "https://thanpd-kaopiz.github.io/doc4-ec-cube-vn/assets/images/site-logo.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "EC-CUBE",
      "url": "https://thanpd-kaopiz.github.io/doc4-ec-cube-vn",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->

<!-- Google Search Console -->
<meta name="google-site-verification" content="RaTQVaBvAuWi45pAV3ydq19nxTrbyV1vooYDZqFA5kQ" />


<link href="/doc4-ec-cube-vn/feed.xml" type="application/atom+xml" rel="alternate" title="< for EC-CUBE 4 Developers /> Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/doc4-ec-cube-vn/assets/css/main.css">
<link rel="stylesheet" href="/doc4-ec-cube-vn/assets/font-awesome-4.7.0/css/font-awesome.min.css">
<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="shortcut icon" href="/doc4-ec-cube-vn/assets/images/favicon.ico">

<!-- end custom head snippets -->

</head>

<body class="layout--single">
<nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

<!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->



<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/doc4-ec-cube-vn/">
          < for EC-CUBE 4 Developers />
          <span class="site-subtitle">EC-CUBE 4 開発者向けドキュメントサイト</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="https://www.ec-cube.net/" target="_blank" >Về EC-CUBE</a>
            </li><li class="masthead__menu-item">
              <a href="https://xoops.ec-cube.net/" target="_blank" >Cộng đồng phát triển</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


<div class="initial-content">
    



<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">ec-cube.co</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/co" class="">ec-cube.co là gì</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/co/co_security" class="">Về các biện pháp bảo mật</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/co/co_update_guidelines" class="">Hướng dẫn cập nhật</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/co/co_console" class="">Console</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/co/co_naming_rules" class="">Quy tắc đặt tên</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/co/co_git" class="">Đặc tả chức năng quản lý Git</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/co/co_customize_dir_usage" class="">Cách sử dụng thư mục tùy chỉnh</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/co/co_staging" class="">Xây dựng môi trường thử nghiệm</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/co/co_log" class="">Cách lấy log</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/co/co_faq" class="">FAQ</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Giới thiệu</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/quickstart/latest_version" class="">Phiên bản mới nhất</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/quickstart/requirement" class="">Yêu cầu hệ thống</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/quickstart/cautions_of_prod" class="">Lưu ý khi sử dụng trong môi trường sản xuất</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Thông tin cho người mới bắt đầu</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/learning/learning_step" class="">Các bước học tập</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Cài đặt</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/quickstart/install" class="">Các phương pháp cài đặt khác nhau</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/quickstart/cli" class="">Giao diện dòng lệnh</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Nâng cấp phiên bản</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/update43" class="">Nâng cấp phiên bản chính từ 4.2 lên 4.3</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/update-42-43" class="active">Di chuyển từ 4.2 lên 4.3</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/update-41-42" class="">Di chuyển từ 4.1 lên 4.2</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/update41" class="">Nâng cấp phiên bản chính từ 4.0 lên 4.1</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/update-40-41" class="">Di chuyển từ 4.0 lên 4.1</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/update42x" class="">Nâng cấp phiên bản chính 4.2</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/update41x" class="">Nâng cấp phiên bản chính 4.1</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/update" class="">Nâng cấp phiên bản chính 4.0</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/update/4_0_3" class="">Lưu ý trong phiên bản 4.0.3</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/hotfix_samesite_cookie" class="">Hỗ trợ Cookie SameSite</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Đặc tả chức năng</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="https://www.ec-cube.net/product/functions.php" target="_blank" class="">Danh sách chức năng</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/spec_order" class="">Liên quan đến đơn hàng</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/spec_tax" class="">Cài đặt thuế suất</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/spec_payment" class="">Cài đặt phương thức thanh toán</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Tùy chỉnh hệ thống</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/spec_directory-structure" class="">Cấu trúc thư mục</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/customize_controller" class="">Tùy chỉnh Controller</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/customize_entity" class="">Tùy chỉnh Entity</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/customize_repository" class="">Tùy chỉnh Repository</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/customize_formtype" class="">Tùy chỉnh FormType</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/customize_service" class="">Tùy chỉnh quy trình mua hàng</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/customize_order_state_machine" class="">Tùy chỉnh trạng thái đơn hàng</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/customize_template" class="">Tùy chỉnh mẫu giao diện</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/customize_throttling" class="">Tùy chỉnh chức năng throttling</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/customize_twig_sandbox" class="">Kiểm soát danh sách cho phép bằng Twig Sandbox</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/customize_symfony" class="">Mở rộng bằng chức năng của Symfony</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/customize_symfony#command" class="">Phát triển Command</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Tùy chỉnh thiết kế</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/design_template" class="">Cơ bản về mẫu thiết kế</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/design_block" class="">Sử dụng block</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/design_layout" class="">Sử dụng quản lý bố cục</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/design_img" class="">Về quản lý hình ảnh</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/design_css" class="">Sử dụng CSS</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/design_sass" class="">Sử dụng Sass(scss)</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/design_form" class="">Thay đổi bố cục form</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/design_messages" class="">Tùy chỉnh thông điệp</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="https://eccube4-styleguide.herokuapp.com" target="_blank" class="">Tài liệu tham khảo thiết kế giao diện người dùng (hướng dẫn phong cách)</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="https://thanpd-kaopiz.github.io/doc4-ec-cube-vn/pdf/ec-cube4_design-guide180930.pdf" target="_blank" class="">Tài liệu tham khảo thiết kế giao diện quản trị (hướng dẫn thiết kế)</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="http://downloads.ec-cube.net/manual/documents/eccube4_xd_front_template.zip?argument=2qpV46CP&dmai=a5bf51b05bacc5" target="_blank" class="">Mẫu giao diện người dùng cho Adobe XD</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="http://downloads.ec-cube.net/manual/documents/eccube4_xd_admin_template.zip?argument=2qpV46CP&dmai=a5bf51b05bacc5" target="_blank" class="">Mẫu giao diện quản trị cho Adobe XD</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Phát triển plugin</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/plugin_spec" class="">Đặc tả plugin</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/plugin_install" class="">Cài đặt plugin</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/plugin_error" class="">Cách xử lý sự cố plugin</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/plugin_sample" class="">Mẫu plugin</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/plugin_development" class="">Phát triển plugin</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/plugin_mock_package_api" class="">Kiểm tra cài đặt qua Owner's Store</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/plugin_naming_conventions" class="">Quy tắc đặt tên khuyến nghị cho plugin</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/plugin_admin_nav" class="">Mở rộng điều hướng quản trị</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/plugin_eccube40" class="">Lưu ý khi sử dụng EC-CUBE4.0 (Composer v1)</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Thay đổi cài đặt</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/i18n_multilingualization" class="">Đa ngôn ngữ</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/i18n_currency" class="">Tiền tệ</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/i18n_timezone" class="">Múi giờ</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/environmental_setting" class="">Cài đặt môi trường</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/debug_mode" class="">Chế độ gỡ lỗi</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/session_handler_settings" class="">Phương pháp lưu trữ phiên</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Công cụ phát triển</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/development-tools/mail-catcher" class="">MailCatcher</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Thực hiện kiểm tra bảo mật</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/penetration-testing" class="">Giới thiệu</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/penetration-testing/quick_start" class="">Bắt đầu nhanh</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/penetration-testing/introduction" class="">Giới thiệu</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/penetration-testing/about_owaspzap" class="">Về OWASP ZAP</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/penetration-testing/planning" class="">Lập kế hoạch kiểm tra</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/penetration-testing/testing" class="">Thực hiện kiểm tra</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/penetration-testing/review" class="">Đánh giá kiểm tra</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/penetration-testing/improvement" class="">Cải thiện bảo mật</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Hướng dẫn bảo mật</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/security-guideline/coding" class="">Về mã hóa</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/security-guideline/plugin" class="">Tăng cường bảo mật trong phát triển plugin</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Tham khảo ngược</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/reverse-lookup/tips" class="">Mẹo</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/reverse-lookup/sample-code" class="">Bộ sưu tập mẫu tùy chỉnh</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Tham gia phát triển</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="https://www.ec-cube.net/committer/" target="_blank" class="">Làm thế nào để tham gia phát triển EC-CUBE? (Trang web chính thức)</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/contribution-guide/overview" class="">Tổng quan về phát triển</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/contribution-guide/pull-request" class="">Cách tạo pull request</a></li>
              
          
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Khi không tìm thấy tài liệu</span>
        

        
        <ul>
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/documents/request" class="">Yêu cầu tài liệu</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/documents/writing-and-formatting" class="">Thêm và viết tài liệu</a></li>
              
          
          
            
              
              

              
              

              
                <li><a href="/doc4-ec-cube-vn/documents/contribute" class="">Đóng góp tài liệu</a></li>
              
          
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Di chuyển từ 4.2 lên 4.3">
    <meta itemprop="description" content="Giải thích về di chuyển từ EC-CUBE 4.2 lên 4.3.">
    <meta itemprop="datePublished" content="June 20, 2025">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Di chuyển từ 4.2 lên 4.3
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
<!--
            <a href="#disqus_thread" style="font-size:21px;margin-bottom:3px;">
              <img src="//c.disquscdn.com/next/current/publisher-admin/assets/img/emoji/love-512x512.png" style="height: 24px;width: 24px;">
              ページを評価/質問する
              <img src="//c.disquscdn.com/next/current/publisher-admin/assets/img/emoji/sad-512x512.png" style="height: 24px;width: 24px;">
            </a>
-->
            <a href="https://github.com/thanpd-kaopiz/doc4-ec-cube-vn/edit/gh-pages/_pages/quickstart/update_42_43.md"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> Chỉnh sửa trang</a>
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> Mục lục</h4></header>
              <ul class="toc__menu">
  <li><a href="#về-tính-tương-thích-của-plugin">Về tính tương thích của plugin</a></li>
  <li><a href="#tương-thích-php83">Tương thích PHP8.3</a></li>
  <li><a href="#tương-thích-symfony6">Tương thích Symfony6</a>
    <ul>
      <li><a href="#liên-quan-đến-session">Liên quan đến Session</a>
        <ul>
          <li><a href="#bỏ-injection-của-sessioninterface">Bỏ injection của SessionInterface</a></li>
        </ul>
      </li>
      <li><a href="#liên-quan-đến-container">Liên quan đến Container</a>
        <ul>
          <li><a href="#hạn-chế-lấy-dịch-vụ-từ-container">Hạn chế lấy dịch vụ từ container</a></li>
          <li><a href="#thay-đổi-cách-lấy-tham-số">Thay đổi cách lấy tham số</a></li>
        </ul>
      </li>
      <li><a href="#liên-quan-đến-passwordencoder">Liên quan đến PasswordEncoder</a>
        <ul>
          <li><a href="#bỏ-passwordencoder">Bỏ PasswordEncoder</a></li>
          <li><a href="#tự-động-cập-nhật-thuật-toán-mã-hóa-mật-khẩu">Tự động cập nhật thuật toán mã hóa mật khẩu</a></li>
        </ul>
      </li>
      <li><a href="#mã-kiểm-tra">Mã kiểm tra</a>
        <ul>
          <li><a href="#không-thể-kiểm-tra-bằng-expectoutputregex">Không thể kiểm tra bằng expectOutputRegex</a></li>
          <li><a href="#muốn-kiểm-tra-session">Muốn kiểm tra session</a></li>
          <li><a href="#thông-điệp-xác-thực">Thông điệp xác thực</a></li>
        </ul>
      </li>
      <li><a href="#các-thay-đổi-khác">Các thay đổi khác</a></li>
    </ul>
  </li>
  <li><a href="#kiểm-tra-cài-đặt-plugin-qua-owners-store">Kiểm tra cài đặt plugin qua Owner’s Store</a></li>
  <li><a href="#thay-đổi-purchaseflowyaml">Thay đổi purchaseflow.yaml</a>
    <ul>
      <li><a href="#ví-dụ-sửa-đổi">Ví dụ sửa đổi</a></li>
      <li><a href="#hỗ-trợ-cả-hai-phiên-bản-4243-trong-plugin">Hỗ trợ cả hai phiên bản 4.2/4.3 trong plugin</a>
        <ul>
          <li><a href="#khi-chỉ-định-bằng-annotation">Khi chỉ định bằng annotation</a></li>
          <li><a href="#khi-chỉ-định-bằng-tệp-yaml">Khi chỉ định bằng tệp yaml</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
            </nav>
          </aside>
        
        <p>Giải thích về di chuyển từ EC-CUBE 4.2 lên 4.3.</p>

<p>Tổng hợp các phần cần chuyển mã để EC-CUBE 4.3 tương thích với EC-CUBE bản chính và một số plugin chính thức.</p>

<ul>
  <li><a href="https://github.com/EC-CUBE/ec-cube/issues/6069" target="_blank">Lộ trình EC-CUBE 4.3</a></li>
  <li><a href="https://github.com/EC-CUBE/ec-cube/pull/6073" target="_blank">Tương thích Symfony6</a></li>
  <li><a href="https://github.com/EC-CUBE/ProductReview-plugin/pull/93" target="_blank">Plugin Đánh giá sản phẩm: Tương thích Symfony 6</a></li>
  <li><a href="https://github.com/EC-CUBE/eccube-api4/pull/164" target="_blank">Plugin API: Tương thích Symfony 6</a></li>
  <li><a href="https://github.com/EC-CUBE/mail-magazine-plugin/pull/146" target="_blank">Plugin Mail Magazine: Tương thích Symfony 6</a></li>
</ul>

<h2 id="về-tính-tương-thích-của-plugin">Về tính tương thích của plugin</h2>

<p>EC-CUBE 4.2 và 4.3 đảm bảo tính tương thích của plugin.</p>

<p>Bằng cách thực hiện các sửa đổi trong tài liệu này, có thể chạy plugin trên cả hai phiên bản.</p>

<p>Nếu chạy plugin trên cả hai phiên bản, không cần thay đổi mã plugin trong <code class="language-plaintext highlighter-rouge">composer.json</code>.</p>

<h2 id="tương-thích-php83">Tương thích PHP8.3</h2>

<p>Trong EC-CUBE 4.3, yêu cầu hệ thống PHP là 8.1〜8.3.</p>

<p>Các cảnh báo không khuyến khích trong PHP7.4〜8.1, đặc biệt là liên quan đến tham số kiểu, sẽ trở thành lỗi và không hoạt động.</p>

<p>Dưới đây là một ví dụ về lỗi.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ bin/console
PHP Fatal error:  Declaration of Eccube\Kernel::getCacheDir() must be compatible with Symfony\Component\HttpKernel\Kernel::getCacheDir(): string in /path/to/ec-cube/src/Eccube/Kernel.php on line 68
Symfony\Component\ErrorHandler\Error\FatalError^ {#45
  #message: "Compile Error: Declaration of Eccube\Kernel::getCacheDir() must be compatible with Symfony\Component\HttpKernel\Kernel::getCacheDir(): string"
  #code: 0
  #file: "./src/Eccube/Kernel.php"
  #line: 68
  -error: array:4 [
    "type" =&gt; 64
    "message" =&gt; "Declaration of Eccube\Kernel::getCacheDir() must be compatible with Symfony\Component\HttpKernel\Kernel::getCacheDir(): string"
    "file" =&gt; "/path/to/ec-cube/src/Eccube/Kernel.php"
    "line" =&gt; 68
  ]
}

</code></pre></div></div>

<p>Nếu gặp lỗi như vậy, có thể giải quyết bằng cách chỉ định tham số kiểu cho tham số và giá trị trả về.</p>

<p>Dưới đây là ví dụ sửa lỗi trên.</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">class Kernel extends BaseKernel
</span><span class="err">{</span>

<span class="err">...</span>

<span class="gd">-    public function getCacheDir()
</span><span class="gi">+    public function getCacheDir(): string
</span>    {
        return $this-&gt;getProjectDir().'/var/cache/'.$this-&gt;environment;
    }
</code></pre></div></div>

<p>Về các thay đổi không tương thích của PHP, hãy tham khảo hướng dẫn di chuyển trên php.net.</p>

<ul>
  <li>https://www.php.net/manual/ja/migration82.php</li>
  <li>https://www.php.net/manual/ja/migration83.php</li>
</ul>

<h2 id="tương-thích-symfony6">Tương thích Symfony6</h2>

<p>Không thể bao quát hết các thay đổi trong Symfony6, nếu có vấn đề không được đề cập, hãy tham khảo tài liệu UPGRADE của Symfony.</p>

<ul>
  <li><a href="https://github.com/symfony/symfony/blob/6.4/UPGRADE-6.0.md" target="_blank">UPGRADE-6.0.md</a></li>
</ul>

<p>Ngoài ra, để duy trì tính tương thích giữa EC-CUBE4.2 và EC-CUBE4.3, có một số phần không sửa đổi các thông báo deprecation.</p>

<p>※ Có thể xuất hiện thông báo <code class="language-plaintext highlighter-rouge">User Deprecated: xxx</code> trong log, nhưng không ảnh hưởng đến hoạt động.</p>

<p>Dù thực hiện sửa đổi này, EC-CUBE vẫn hoạt động trên cả EC-CUBE 4.2/4.3.</p>

<h3 id="liên-quan-đến-session">Liên quan đến Session</h3>

<h4 id="bỏ-injection-của-sessioninterface">Bỏ injection của SessionInterface</h4>

<p>Injection bằng <code class="language-plaintext highlighter-rouge">SessionInterface</code> đã bị loại bỏ.</p>

<p>Khi sử dụng <code class="language-plaintext highlighter-rouge">Session</code>, hãy lấy từ <code class="language-plaintext highlighter-rouge">RequestStack</code>.</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- use Symfony\Component\HttpFoundation\Session\SessionInterface;
</span><span class="gi">+ use Symfony\Component\HttpFoundation\RequestStack; 
</span><span class="err">...</span>

<span class="gd">- public function index(SessionInterface $session)
</span><span class="gi">+ public function index(RequestStack $requestStack)
</span><span class="err">{</span>
+    $session = $requestStack-&gt;getSession();    
    $session-&gt;get('key');
<span class="err">}</span>
</code></pre></div></div>

<p>Nếu không cần chạy trên EC-CUBE 4.2 (chỉ hỗ trợ 4.3), có thể sử dụng <code class="language-plaintext highlighter-rouge">Eccube\Session\Session</code>.</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- use Symfony\Component\HttpFoundation\Session\SessionInterface;
</span><span class="gi">+ use Eccube\Session\Session; 
</span><span class="err">...</span>

<span class="gd">- public function index(SessionInterface $session)
</span><span class="gi">+ public function index(Session $session)
</span><span class="err">{</span>
    $session-&gt;get('key');
<span class="err">}</span>
</code></pre></div></div>

<h3 id="liên-quan-đến-container">Liên quan đến Container</h3>

<h4 id="hạn-chế-lấy-dịch-vụ-từ-container">Hạn chế lấy dịch vụ từ container</h4>

<p>Khi lấy dịch vụ bằng <code class="language-plaintext highlighter-rouge">$container-&gt;get(Hoge::class)</code>, cần chỉ định là service locator.</p>

<p>Ngoài ra, khi sử dụng container class, hãy sử dụng <code class="language-plaintext highlighter-rouge">Psr\Container\ContainerInterface</code> thay vì <code class="language-plaintext highlighter-rouge">Symfony\Component\DependencyInjection\ContainerInterface</code>.</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- use Symfony\Component\DependencyInjection\ContainerInterface;
</span><span class="gi">+ use Psr\Container\ContainerInterface;
</span>
...

public function __construct(ContainerInterface $container)
<span class="err">{</span>
    $this-&gt;customerRepository = $this-&gt;container-&gt;get(CustomerRepository::class);
<span class="err">}</span>

</code></pre></div></div>

<p>Ví dụ về services.yaml:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>services
    Eccube\Controller\SampleController:
        arguments:
            $container: !service_locator
                Eccube\Repository\CustomerRepository: '@Eccube\Repository\CustomerRepository'
</code></pre></div></div>

<p>Việc gọi dịch vụ trong PluginManager cũng bị ảnh hưởng bởi thay đổi này.</p>

<p>Có thể lấy dịch vụ từ container như sau.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// ManagerRegistory
- $container-&gt;get('doctrine');
- $container-&gt;get(ManagerRegistry::class);

// EntityManager
- $container-&gt;get('doctrine.orm.default_entity_manager');
- $container-&gt;get('doctrine.orm.entity_manager');
- $container-&gt;get(EntityManagerInterface::class);

// EccubeConfig
- $container-&gt;get(EccubeConfig::class);
</code></pre></div></div>

<h4 id="thay-đổi-cách-lấy-tham-số">Thay đổi cách lấy tham số</h4>

<p>Không thể lấy tham số bằng <code class="language-plaintext highlighter-rouge">$container-&gt;getParameter('key')</code>.</p>

<p>Thay vào đó, hãy sử dụng <code class="language-plaintext highlighter-rouge">Eccube\Common\EccubeConfig</code>.</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- use Symfony\Component\DependencyInjection\ContainerInterface;
</span><span class="gi">+ use Eccube\Common\EccubeConfig; 
</span>
...

- public function index(ContainerInterface $container)
<span class="gi">+ public function index(EccubeConfig $eccubeConfig)
</span><span class="err">{</span>
-    $projectDir = $container-&gt;getParameter('kernel.project_dir');
<span class="gi">+    $projectDir = $eccubeConfig-&gt;get('kernel.project_dir');
</span><span class="err">}</span>
</code></pre></div></div>

<h3 id="liên-quan-đến-passwordencoder">Liên quan đến PasswordEncoder</h3>

<h4 id="bỏ-passwordencoder">Bỏ PasswordEncoder</h4>

<p><code class="language-plaintext highlighter-rouge">PasswordEncoder</code> đã bị loại bỏ, thay vào đó sử dụng <code class="language-plaintext highlighter-rouge">PasswordHaser</code>.</p>

<p>Khi sử dụng <code class="language-plaintext highlighter-rouge">PasswordHaser</code> để mã hóa mật khẩu, mã sẽ như sau.</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- use Symfony\Component\Security\Core\Encoder\EncoderFactoryInterface;
</span><span class="gi">+ use Symfony\Component\PasswordHasher\Hasher\UserPasswordHasherInterface;
</span>
...

public function __construct(
<span class="gd">-    EncoderFactoryInterface $encoderFactory,
</span><span class="gi">+    UserPasswordHasherInterface $passwordHasher
</span><span class="err">)</span> {
<span class="gd">-    $this-&gt;encoderFactory = $encoderFactory;
</span><span class="gi">+    $this-&gt;passwordHasher = $passwordHasher;
</span><span class="err">}</span>

<span class="err">...</span>

<span class="gd">- $encoder = $this-&gt;encoderFactory-&gt;getEncoder($Customer);
</span>
if ($Customer-&gt;getPlainPassword() !== $this-&gt;eccubeConfig['eccube_default_password']) {
<span class="gd">-    $Customer-&gt;setPassword($encoder-&gt;encodePassword($Customer-&gt;getPlainPassword(), $Customer-&gt;getSalt()));
</span><span class="gi">+    $Customer-&gt;setPassword($this-&gt;passwordHasher-&gt;hashPassword($Customer, $Customer-&gt;getPlainPassword()));
</span><span class="err">}</span>
</code></pre></div></div>

<p>Nếu tự triển khai PasswordEncoder, hãy thay đổi để sử dụng PasswordHasher như sau.</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- class UserPasswordEncoder implements UserPasswordEncoderInterface
</span><span class="gi">+ class UserPasswordEncoder
</span></code></pre></div></div>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">Plugin\Api42\EventListener\UserResolveListener:
</span>    arguments:
        - '@Eccube\Security\Core\User\MemberProvider'
<span class="gd">-        - '@Plugin\Api42\Security\Core\Encoder\UserPasswordEncoder'
</span><span class="gi">+        - '@Symfony\Component\PasswordHasher\Hasher\UserPasswordHasherInterface'
</span></code></pre></div></div>

<p>Nếu thay thế bằng <code class="language-plaintext highlighter-rouge">@Symfony\Component\PasswordHasher\Hasher\UserPasswordHasherInterface</code> và hoạt động, có thể xóa PasswordEncoder.</p>

<h4 id="tự-động-cập-nhật-thuật-toán-mã-hóa-mật-khẩu">Tự động cập nhật thuật toán mã hóa mật khẩu</h4>

<p>Bằng cách sử dụng <code class="language-plaintext highlighter-rouge">PasswordHaser</code>, thuật toán mã hóa mật khẩu sẽ tự động cập nhật.</p>

<p>Kiểm tra thuật toán sử dụng sẽ được thực hiện khi người dùng đăng nhập, nếu cần cập nhật thuật toán, mật khẩu sẽ được mã hóa lại bằng thuật toán mới và lưu vào DB.</p>

<p>Nếu sử dụng thuật toán AUTH_MAGIC truyền thống của EC-CUBE, thuật toán sẽ được cập nhật khi đăng nhập. Thuật toán mới sẽ bao gồm giá trị salt trong mật khẩu đã mã hóa, do đó, cột salt trong dtb_member/customer sẽ không còn sử dụng.</p>

<p>Tham khảo thêm <a href="https://symfony.com/doc/current/security/passwords.html" target="_blank">Password Hashing and Verification</a>.</p>

<h3 id="mã-kiểm-tra">Mã kiểm tra</h3>

<h4 id="không-thể-kiểm-tra-bằng-expectoutputregex">Không thể kiểm tra bằng expectOutputRegex</h4>

<p>Khi kiểm tra phản hồi tải xuống csv bằng expectOutputRegex, có thể không hoạt động.</p>

<p>Có thể lấy nội dung xuất ra bằng <code class="language-plaintext highlighter-rouge">$client-&gt;getInternalResponse()-&gt;getContent()</code>, hãy sử dụng cách này.</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">...</span>

<span class="gd">- $this-&gt;expectOutputRegex("/{$review-&gt;getTitle()}/");
</span>
$this-&gt;client-&gt;request(
    'POST',
    $this-&gt;generateUrl('product_review_admin_product_review_download')
<span class="err">);</span>

<span class="err">$this-&gt;assertTrue($this-&gt;client-&gt;getResponse()-&gt;isSuccessful());</span>

<span class="gi">+ $content = $this-&gt;client-&gt;getInternalResponse()-&gt;getContent();
+ $content = mb_convert_encoding($content, 'UTF-8', 'SJIS-win'); // Nếu cần, chuyển đổi mã hóa
+ $this-&gt;assertMatchesRegularExpression("/{$review-&gt;getTitle()}/", $content);
</span></code></pre></div></div>

<h4 id="muốn-kiểm-tra-session">Muốn kiểm tra session</h4>

<p>Nếu muốn kiểm tra giá trị session, <code class="language-plaintext highlighter-rouge">static::getContainer()-&gt;get('session')</code> không hoạt động.</p>

<p>Hãy sử dụng <code class="language-plaintext highlighter-rouge">Eccube\Tests\Web\AbstractWebTestCase::createSession</code>.</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
- $session = static::getContainer()-&gt;get('session');
<span class="gi">+ $session = $this-&gt;createSession($this-&gt;client)
</span><span class="err">$outPut</span> = $session-&gt;getFlashBag()-&gt;get('eccube.admin.success');

</code></pre></div></div>

<h4 id="thông-điệp-xác-thực">Thông điệp xác thực</h4>

<p>Một số thông điệp xác thực đã thay đổi. Các bài kiểm tra tự động kiểm tra thông điệp xác thực có thể cần sửa đổi. Không cần sửa mã sản phẩm.</p>

<h3 id="các-thay-đổi-khác">Các thay đổi khác</h3>

<h2 id="kiểm-tra-cài-đặt-plugin-qua-owners-store">Kiểm tra cài đặt plugin qua Owner’s Store</h2>

<p>Endpoint khi cài đặt plugin qua Owner’s Store đã thay đổi.</p>

<p>Hiện tại (31/01/2024) chưa được triển khai, nhưng dự kiến sẽ là endpoint dưới đây.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ECCUBE_PACKAGE_API_URL=https://package-api-c2.ec-cube.net/v43
</code></pre></div></div>

<h2 id="thay-đổi-purchaseflowyaml">Thay đổi purchaseflow.yaml</h2>
<p>Từ 4.3, định dạng của purchaseflow.yaml đã thay đổi.
Thay đổi từ cách “thiết lập phương thức từ cha đến con” sang cách “thiết lập phương thức cho cha nào”.
Ngoài ra, có thể thay đổi thứ tự thực thi trong purchaseflow bằng cách thiết lập priority.
Xem chi tiết tại <a href="https://github.com/EC-CUBE/ec-cube/pull/5147">đây</a>.</p>
<h3 id="ví-dụ-sửa-đổi">Ví dụ sửa đổi</h3>
<p>Lấy ví dụ về thay đổi của ProductStatusValidator.<br />
Dưới đây là định nghĩa trong 4.2.</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 4.2_purchaseflow.yaml</span>
<span class="na">eccube.purchase.flow.cart</span><span class="pi">:</span>
    <span class="na">class</span><span class="pi">:</span> <span class="s">Eccube\Service\PurchaseFlow\PurchaseFlow</span>
    <span class="na">calls</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="pi">[</span><span class="nv">setFlowType</span><span class="pi">,</span> <span class="pi">[</span><span class="s1">'</span><span class="s">cart'</span><span class="pi">]]</span>
        <span class="pi">-</span> <span class="pi">[</span><span class="nv">setItemValidators</span><span class="pi">,</span> <span class="pi">[</span><span class="s1">'</span><span class="s">@eccube.purchase.flow.cart.item_validators'</span><span class="pi">]]</span>
            
<span class="na">eccube.purchase.flow.cart.item_validators</span><span class="pi">:</span>
    <span class="na">class</span><span class="pi">:</span> <span class="s">Doctrine\Common\Collections\ArrayCollection</span>
    <span class="na">arguments</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="c1">#</span>
            <span class="pi">-</span> <span class="s1">'</span><span class="s">@Eccube\Service\PurchaseFlow\Processor\ProductStatusValidator'</span> <span class="c1"># Kiểm tra trạng thái công khai của sản phẩm</span>
</code></pre></div></div>

<p>Tiếp theo là định nghĩa trong 4.3.</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 4.3_purchaseflow.yaml</span>
<span class="na">eccube.purchase.flow.cart</span><span class="pi">:</span>
    <span class="na">class</span><span class="pi">:</span> <span class="s">Eccube\Service\PurchaseFlow\PurchaseFlow</span>
    <span class="na">calls</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="pi">[</span> <span class="nv">setFlowType</span><span class="pi">,</span> <span class="pi">[</span> <span class="s1">'</span><span class="s">cart'</span> <span class="pi">]</span> <span class="pi">]</span>

<span class="na">eccube.purchase.flow.item.validator.product.status.validator</span><span class="pi">:</span> <span class="c1"># Kiểm tra trạng thái công khai của sản phẩm</span>
    <span class="na">class</span><span class="pi">:</span> <span class="s">Eccube\Service\PurchaseFlow\Processor\ProductStatusValidator</span>
    <span class="na">tags</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="pi">{</span> <span class="nv">name</span><span class="pi">:</span> <span class="nv">eccube.item.validator</span><span class="pi">,</span> <span class="nv">flow_type</span><span class="pi">:</span> <span class="nv">cart</span><span class="pi">,</span> <span class="nv">priority</span><span class="pi">:</span> <span class="nv">900</span> <span class="pi">}</span>
</code></pre></div></div>

<h3 id="hỗ-trợ-cả-hai-phiên-bản-4243-trong-plugin">Hỗ trợ cả hai phiên bản 4.2/4.3 trong plugin</h3>

<p>Khi sử dụng purchase flow trong plugin và muốn hỗ trợ cả hai phiên bản 4.2/4.3, hãy làm theo hướng dẫn dưới đây.</p>

<h4 id="khi-chỉ-định-bằng-annotation">Khi chỉ định bằng annotation</h4>

<p>Các annotation như @CartFlow vẫn có thể sử dụng trong 4.3.</p>

<p>priority luôn là 0 và processor sẽ được thêm vào cuối danh sách như trước.</p>

<h4 id="khi-chỉ-định-bằng-tệp-yaml">Khi chỉ định bằng tệp yaml</h4>

<p>Nếu ghi đè cài đặt hiện có bằng tệp yaml, hãy chuyển sang cài đặt bằng tệp php và phân nhánh theo phiên bản EC-CUBE.</p>

<p>Dưới đây là ví dụ sửa đổi khi thực hiện SampleProcessor trước các processor hiện có.</p>

<p>SampleProcessor</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">Plugin\Sample\Service\PurchaseFlow</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Eccube\Entity\ItemInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Eccube\Service\PurchaseFlow\ItemValidator</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Eccube\Service\PurchaseFlow\PurchaseContext</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">SampleProcessor</span> <span class="kd">extends</span> <span class="nc">ItemValidator</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="n">validate</span><span class="p">(</span><span class="kt">ItemInterface</span> <span class="nv">$item</span><span class="p">,</span> <span class="kt">PurchaseContext</span> <span class="nv">$context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nf">dump</span><span class="p">(</span><span class="mi">123</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Cài đặt trong 4.2</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Plugin/Sample/Resource/config/services.yaml</span>

<span class="na">eccube.purchase.flow.cart.item_validators</span><span class="pi">:</span>
  <span class="na">class</span><span class="pi">:</span> <span class="s">Doctrine\Common\Collections\ArrayCollection</span>
  <span class="na">arguments</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="c1">#</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">@Plugin\Sample\Service\PurchaseFlow\SampleProcessor'</span> <span class="c1"># SampleProcessor</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">@Eccube\Service\PurchaseFlow\Processor\DeliverySettingValidator'</span> <span class="c1"># Kiểm tra cài đặt giao hàng</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">@Eccube\Service\PurchaseFlow\Processor\ProductStatusValidator'</span> <span class="c1"># Kiểm tra trạng thái công khai của sản phẩm</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">@Eccube\Service\PurchaseFlow\Processor\PriceChangeValidator'</span> <span class="c1"># Phát hiện thay đổi giá sản phẩm</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">@Eccube\Service\PurchaseFlow\Processor\StockValidator'</span> <span class="c1"># Kiểm tra tồn kho</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">@Eccube\Service\PurchaseFlow\Processor\SaleLimitValidator'</span> <span class="c1"># Kiểm tra giới hạn bán hàng</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">@Eccube\Service\PurchaseFlow\Processor\ClassCategoryValidator'</span> <span class="c1"># Kiểm tra trạng thái công khai của loại sản phẩm</span>
</code></pre></div></div>

<p>Cài đặt hỗ trợ cả hai phiên bản 4.2/4.3</p>

<p>Xóa services.yaml và tạo services.php. Phân nhánh theo phiên bản EC-CUBE trong services.php.</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Plugin/Sample/Resource/config/services.php

<span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">Symfony\Component\DependencyInjection\Loader\Configurator</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Doctrine\Common\Collections\ArrayCollection</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Eccube\Common\Constant</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Plugin\Sample\Service\PurchaseFlow\SampleProcessor</span><span class="p">;</span>

<span class="k">return</span> <span class="k">function</span><span class="p">(</span><span class="kt">ContainerConfigurator</span> <span class="nv">$containerConfigurator</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$services</span> <span class="o">=</span> <span class="nv">$containerConfigurator</span><span class="o">-&gt;</span><span class="nf">services</span><span class="p">();</span>

    <span class="c1">// 4.3</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">version_compare</span><span class="p">(</span><span class="nc">Constant</span><span class="o">::</span><span class="no">VERSION</span><span class="p">,</span> <span class="s1">'4.3'</span><span class="p">,</span> <span class="s1">'&gt;='</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$services</span>
            <span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="nc">SampleProcessor</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">tag</span><span class="p">(</span><span class="s1">'eccube.item.validator'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'flow_type'</span> <span class="o">=&gt;</span> <span class="s1">'cart'</span><span class="p">,</span> <span class="s1">'priority'</span> <span class="o">=&gt;</span> <span class="mi">2000</span><span class="p">]);</span> <span class="c1">// Thực hiện trước, priority lớn hơn các processor hiện có</span>
    <span class="c1">// 4.2</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$services</span>
            <span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="nc">SampleProcessor</span><span class="o">::</span><span class="n">class</span><span class="p">);</span>

        <span class="nv">$services</span>
            <span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'eccube.purchase.flow.cart.item_validators'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">class</span><span class="p">(</span><span class="nc">ArrayCollection</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">args</span><span class="p">([[</span><span class="nf">service</span><span class="p">(</span><span class="s1">'Plugin\Sample\Service\PurchaseFlow\SampleProcessor'</span><span class="p">),</span> <span class="c1"># SampleProcessor</span>
                <span class="nf">service</span><span class="p">(</span><span class="s1">'Eccube\Service\PurchaseFlow\Processor\DeliverySettingValidator'</span><span class="p">),</span> <span class="c1"># Kiểm tra cài đặt giao hàng</span>
                <span class="nf">service</span><span class="p">(</span><span class="s1">'Eccube\Service\PurchaseFlow\Processor\ProductStatusValidator'</span><span class="p">),</span> <span class="c1"># Kiểm tra trạng thái công khai của sản phẩm</span>
                <span class="nf">service</span><span class="p">(</span><span class="s1">'Eccube\Service\PurchaseFlow\Processor\PriceChangeValidator'</span><span class="p">),</span> <span class="c1"># Phát hiện thay đổi giá sản phẩm</span>
                <span class="nf">service</span><span class="p">(</span><span class="s1">'Eccube\Service\PurchaseFlow\Processor\StockValidator'</span><span class="p">),</span> <span class="c1"># Kiểm tra tồn kho</span>
                <span class="nf">service</span><span class="p">(</span><span class="s1">'Eccube\Service\PurchaseFlow\Processor\SaleLimitValidator'</span><span class="p">),</span> <span class="c1"># Kiểm tra giới hạn bán hàng</span>
                <span class="nf">service</span><span class="p">(</span><span class="s1">'Eccube\Service\PurchaseFlow\Processor\ClassCategoryValidator'</span><span class="p">),</span> <span class="c1"># Kiểm tra trạng thái công khai của loại sản phẩm</span>
            <span class="p">]]);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

        
      </section>

      <footer class="page__meta">
        
        
  





        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Ngày cập nhật:</strong> <time datetime="2025-06-20T10:15:25+00:00">June 20, 2025</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Chia sẻ trang</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Di+chuy%E1%BB%83n+t%E1%BB%AB+4.2+l%C3%AAn+4.3%20https%3A%2F%2Fthanpd-kaopiz.github.io%2Fdoc4-ec-cube-vn%2Fupdate-42-43" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Chia sẻ trang Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fthanpd-kaopiz.github.io%2Fdoc4-ec-cube-vn%2Fupdate-42-43" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Chia sẻ trang Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>
</section>


<!--
      <div style="font-size: 15pt;margin-top:20px;margin-bottom:-30px;">
        <div>　</div>
        <div>　</div>
        <div style="font-weight:bold;">■質問、書いてほしい情報など、気軽にコメントしてみましょう！</div>
        <div>コメント例：</div>
        <div>　「手順通りやったけど、◯◯の部分でうまくいかない」</div>
        <div>　「◯◯の部分について、もう少し手順を詳細に記載してよ」</div>
        <div>　「最初から、こういう情報があればわかりやすかった」</div>
      </div>
-->

      <!--
  <nav class="pagination">
    
      <a href="/doc4-ec-cube-vn/update-41-42" class="pagination--pager" title="Di chuyển từ 4.1 lên 4.2
">Trước</a>
    
    
      <a href="/doc4-ec-cube-vn/update/4_0_3" class="pagination--pager" title="Lưu ý khi cập nhật lên 4.0.3
">Sau</a>
    
  </nav>
-->
    </div>

    
      <div class="page__comments">
  
  
</div>

    
  </article>

  
  
</div>

</div>


<div class="search-content">
    <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Nhập từ khóa tìm kiếm..." />
  </form>
  <div id="results" class="results"></div></div>

</div>


<div id="footer" class="page__footer">
    <footer>
        <!-- start custom footer snippets -->

<!-- Navメニュー -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
    $('.nav__sub-title').on('click',function(){
        $(this).toggleClass('active');
        $(this).next('ul').slideToggle();
    });
    $(function(){
        $("a.active").parents('ul').css("display", "block");
    });
</script>

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Theo dõi</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/doc4-ec-cube-vn/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 EC-CUBE. Phát triển bởi <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

    </footer>
</div>


  <script src="/doc4-ec-cube-vn/assets/js/main.min.js"></script>




<script src="/doc4-ec-cube-vn/assets/js/lunr/lunr.min.js"></script>
<script src="/doc4-ec-cube-vn/assets/js/lunr/lunr-store.js"></script>
<script src="/doc4-ec-cube-vn/assets/js/lunr/lunr-en.js"></script>









</body>
</html>
